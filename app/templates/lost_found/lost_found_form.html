{% extends 'base.html' %}
{% block title %}发布失物/招领{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-3">{{ item and '编辑信息' or '发布信息' }}</h2>
  <form method="post" enctype="multipart/form-data">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">类型</label>
        <select name="type" class="form-select" required>
          <option value="lost" {{ (item and item.type=='lost') and 'selected' or '' }}>丢失</option>
          <option value="found" {{ (item and item.type=='found') and 'selected' or '' }}>招领</option>
        </select>
      </div>
      <div class="col-md-8">
        <label class="form-label">标题</label>
        <input type="text" name="title" class="form-control" value="{{ item and item.title or '' }}" required />
      </div>
      <div class="col-md-4">
        <label class="form-label">分类</label>
        <input type="text" name="category" class="form-control" value="{{ item and item.category or '' }}" />
      </div>
      <div class="col-md-4">
        <label class="form-label">地点</label>
        <input type="text" name="location" class="form-control" value="{{ item and item.location or '' }}" />
      </div>
      <div class="col-md-4">
        <label class="form-label">时间</label>
        <input type="datetime-local" name="lost_time" class="form-control" value="{{ item and item.lost_time and item.lost_time|strftime('%Y-%m-%dT%H:%M') }}" />
      </div>
      <div class="col-12">
        <label class="form-label">联系信息</label>
        <input type="text" name="contact" class="form-control" value="{{ item and item.contact or '' }}" />
      </div>
      <div class="col-12">
        <label class="form-label">详细描述</label>
        <textarea name="description" class="form-control" rows="4">{{ item and item.description or '' }}</textarea>
      </div>
      <div class="col-12">
        <label class="form-label">上传图片</label>
        <input type="file" name="images" class="form-control" multiple accept="image/*" />
      </div>
    </div>
    <div class="mt-3">
      <button type="submit" class="btn btn-primary">提交</button>
      {% if item %}
      <a class="btn btn-outline-secondary" href="{{ url_for('lost_found.detail', item_id=item.id) }}">取消</a>
      {% else %}
      <a class="btn btn-outline-secondary" href="{{ url_for('lost_found.list_items') }}">取消</a>
      {% endif %}
    </div>
  </form>
  {% if item and item.images %}
  <div class="mt-4">
    <h5>已上传图片</h5>
    <div class="row g-3">
      {% for img in item.images %}
      <div class="col-6 col-md-3">
        <img src="{{ img }}" class="img-fluid rounded" alt="" />
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
  {% if item %}
  <form method="post" action="{{ url_for('lost_found.delete_item', item_id=item.id) }}" class="mt-4" onsubmit="return confirm('确认删除该发布？')">
    <button type="submit" class="btn btn-danger">删除该发布</button>
  </form>
  {% endif %}
</div>
{% endblock %}