{% extends 'base.html' %}
{% block title %}发布书籍{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-3">{{ book and '编辑书籍' or '发布书籍' }}</h2>
  <form method="post" enctype="multipart/form-data">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">书名</label>
        <input type="text" name="book_name" class="form-control" value="{{ book and book.book_name or '' }}" required />
      </div>
      <div class="col-md-3">
        <label class="form-label">作者</label>
        <input type="text" name="author" class="form-control" value="{{ book and book.author or '' }}" />
      </div>
      <div class="col-md-3">
        <label class="form-label">ISBN</label>
        <input type="text" name="isbn" class="form-control" value="{{ book and book.isbn or '' }}" />
      </div>
      <div class="col-md-4">
        <label class="form-label">出版社</label>
        <input type="text" name="publisher" class="form-control" value="{{ book and book.publisher or '' }}" />
      </div>
      <div class="col-md-4">
        <label class="form-label">课程</label>
        <input type="text" name="course" class="form-control" value="{{ book and book.course or '' }}" />
      </div>
      <div class="col-md-4">
        <label class="form-label">学院</label>
        <input type="text" name="college" class="form-control" value="{{ book and book.college or '' }}" />
      </div>
      <div class="col-md-3">
        <label class="form-label">价格</label>
        <input type="number" step="0.01" min="0" name="price" class="form-control" value="{{ book and book.price or '' }}" />
      </div>
      <div class="col-md-3">
        <label class="form-label">成色</label>
        <select name="condition" class="form-select">
          {% set cond = book and book.condition or '' %}
          <option value="">未选择</option>
          <option value="new" {{ cond=='new' and 'selected' or '' }}>全新</option>
          <option value="like_new" {{ cond=='like_new' and 'selected' or '' }}>99新</option>
          <option value="good" {{ cond=='good' and 'selected' or '' }}>良好</option>
          <option value="fair" {{ cond=='fair' and 'selected' or '' }}>一般</option>
          <option value="poor" {{ cond=='poor' and 'selected' or '' }}>较差</option>
        </select>
      </div>
      <div class="col-12">
        <label class="form-label">书籍描述</label>
        <textarea name="description" class="form-control" rows="4">{{ book and book.description or '' }}</textarea>
      </div>
      <div class="col-12">
        <label class="form-label">上传图片</label>
        <input type="file" name="images" class="form-control" multiple accept="image/*" />
      </div>
    </div>
    <div class="mt-3">
      <button type="submit" class="btn btn-primary">提交</button>
      {% if book %}
      <a class="btn btn-outline-secondary" href="{{ url_for('books.detail', book_id=book.id) }}">取消</a>
      {% else %}
      <a class="btn btn-outline-secondary" href="{{ url_for('books.list_books') }}">取消</a>
      {% endif %}
    </div>
  </form>
  {% if book and book.images %}
  <div class="mt-4">
    <h5>已上传图片</h5>
    <div class="row g-3">
      {% for img in book.images %}
      <div class="col-6 col-md-3">
        <img src="{{ img }}" class="img-fluid rounded" alt="" />
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
  {% if book %}
  <form method="post" action="{{ url_for('books.delete_book', book_id=book.id) }}" class="mt-4" onsubmit="return confirm('确认删除该发布？')">
    <button type="submit" class="btn btn-danger">删除该发布</button>
  </form>
  {% endif %}
</div>
{% endblock %}