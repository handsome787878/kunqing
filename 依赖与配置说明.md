# 依赖与配置说明

本文件汇总项目依赖与关键环境配置，便于快速搭建与排障。

## Python 依赖

- 依赖列表见 `requirements.txt`（版本约束已标注）：
  - `flask`、`flask-login`、`flask-wtf`、`wtforms`
  - `flask-sqlalchemy`、`SQLAlchemy`
  - `bcrypt`、`email-validator`、`pillow`
- 安装：
```
pip install -r requirements.txt
```

## 数据库

- 开发环境使用 SQLite：`kunqing.sqlite`
- 检查当前用户数据：
```
python scripts/check_db.py
```
- 初始化 SQLAlchemy 表并确保超管：
```
python scripts/init_sqlalchemy_db.py
```
- 注意：仓库中的 `create_admin.py`/`init_database.py` 使用 `simple_campus.db`，请勿混用，应用运行基于 `kunqing.sqlite`。

## 邮件 SMTP 配置

在管理后台系统设置页提供 SMTP 自检与测试邮件发送功能。配置项如下（可设置为环境变量或写入 `config.py`）：

- `MAIL_SERVER`：SMTP服务器地址（如 `smtp.qq.com`）
- `MAIL_PORT`：SMTP端口（如 `587`）
- `MAIL_USE_TLS`：启用TLS（推荐）
- `MAIL_USE_SSL`：启用SSL（通常与TLS互斥）
- `MAIL_USERNAME`：登录用户名（发件邮箱）
- `MAIL_PASSWORD`：登录密码或授权码（QQ邮箱需授权码）
- `MAIL_DEFAULT_SENDER`：默认发件人邮箱

示例（QQ邮箱）：
```
MAIL_SERVER=smtp.qq.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=你的QQ邮箱
MAIL_PASSWORD=你的QQ邮箱授权码
MAIL_DEFAULT_SENDER=你的QQ邮箱
```

## 管理员与权限

- 管理员登录入口：`/admin/login`
- 超级管理员访问设置页：`/admin/settings`（`admin_level>=2` 或学号为 `admin`）
- 默认管理员密码：`123456`（旧版SHA256哈希，首次登录自动迁移至 bcrypt）

## 常见问题速查

- 访问 `/admin/settings` 返回 403：未以超管登录。请使用 `admin/123456` 登录后再访问。
- 无法发送邮件：检查 SMTP 环境变量是否正确，设置页内联结果面板的 `duration_ms` 与 `error` 字段可辅助定位问题。